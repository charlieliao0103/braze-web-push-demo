<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Simulation - Braze Integration</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            padding: 20px;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.8;
        }
        
        .content {
            padding: 20px;
        }
        
        .panels {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .panel h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c3e50;
        }
        
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        button {
            width: 100%;
            padding: 12px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .game-btn {
            background: #27ae60;
            margin-top: 10px;
        }
        
        .game-btn:hover {
            background: #219653;
        }
        
        .user-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .user-info h3 {
            color: #1565c0;
            margin-bottom: 10px;
        }
        
        .user-detail {
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }
        
        .user-detail span:first-child {
            font-weight: 500;
        }
        
        .message-log {
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 4px;
        }
        
        .log-info {
            background: #3498db;
        }
        
        .log-success {
            background: #27ae60;
        }
        
        .log-warning {
            background: #f39c12;
        }
        
        .log-error {
            background: #e74c3c;
        }
        
        .in-app-message {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.4s ease;
        }
        
        .message-visible {
            transform: translateX(0);
        }
        
        .message-header {
            background: #2c3e50;
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .message-content {
            padding: 20px;
        }
        
        .message-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .message-text {
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .message-actions {
            display: flex;
            gap: 10px;
        }
        
        .message-btn {
            flex: 1;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-secondary {
            background: #bdc3c7;
            color: #2c3e50;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        .game-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
            display: block;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
    </style>

    <!-- Braze Web SDK -->
    <script>
        (function(){
            const brazeLoader = document.createElement('script');
            brazeLoader.src = 'https://js.appboycdn.com/web-sdk/5.8/braze.min.js';
            brazeLoader.async = true;
            brazeLoader.onload = function() {
                initializeBraze();
            };
            brazeLoader.onerror = function() {
                addLog('Failed to load Braze SDK', 'error');
            };
            document.head.appendChild(brazeLoader);
        })();
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸŽ® Game Simulation</h1>
            <p class="subtitle">Braze User Registration & Message Demo</p>
        </header>
        
        <div class="content">
            <div class="panels">
                <div class="panel">
                    <h2>User Registration</h2>
                    <div class="form-group">
                        <label for="userId">User ID</label>
                        <input type="text" id="userId" placeholder="Enter user ID">
                    </div>
                    <div class="form-group">
                        <label for="userName">Name</label>
                        <input type="text" id="userName" placeholder="Enter your name">
                    </div>
                    <div class="form-group">
                        <label for="userEmail">Email</label>
                        <input type="email" id="userEmail" placeholder="Enter your email">
                    </div>
                    <button id="registerBtn">Register User</button>
                    
                    <div class="user-info" id="userInfo" style="display: none;">
                        <h3>Registered User</h3>
                        <div class="user-detail">
                            <span>ID:</span>
                            <span id="displayUserId"></span>
                        </div>
                        <div class="user-detail">
                            <span>Name:</span>
                            <span id="displayUserName"></span>
                        </div>
                        <div class="user-detail">
                            <span>Email:</span>
                            <span id="displayUserEmail"></span>
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <h2>Game Simulation</h2>
                    <p>Simulate gameplay actions to trigger Braze campaigns</p>
                    
                    <div class="game-stats">
                        <div class="stat">
                            <span class="stat-value" id="score">0</span>
                            <span class="stat-label">Score</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="level">1</span>
                            <span class="stat-label">Level</span>
                        </div>
                    </div>
                    
                    <button class="game-btn" id="playBtn">Play Game</button>
                    <button class="game-btn" id="completeLevelBtn">Complete Level</button>
                    <button class="game-btn" id="makePurchaseBtn">Make Purchase</button>
                </div>
            </div>
            
            <div class="message-log" id="messageLog">
                <div class="log-entry log-info">System initialized. Please register a user to begin.</div>
            </div>
        </div>
    </div>

    <!-- In-App Message Template -->
    <div class="in-app-message" id="in-app-message">
        <div class="message-header" id="message-header">
            <span>Game Notification</span>
            <button class="close-btn" id="close-message">Ã—</button>
        </div>
        <div class="message-content">
            <div class="message-title" id="message-display-title">Special Offer!</div>
            <div class="message-text" id="message-display-content">
                Check out our new game level - available now!
            </div>
            <div class="message-actions">
                <button class="message-btn btn-primary">Claim Now</button>
                <button class="message-btn btn-secondary">Later</button>
            </div>
        </div>
    </div>

    <script>
        // Game state
        let gameState = {
            score: 0,
            level: 1,
            coins: 100
        };
        
        // User state
        let userState = {
            registered: false,
            id: null,
            name: null,
            email: null
        };
        
        // Braze Configuration
        const brazeConfig = {
            apiKey: '84e848cb-2923-4629-bd23-e6e4155615bd',
            endpoint: 'sdk.iad-03.braze.com',
            enableLogging: true
        };
        
        // Initialize Braze
        function initializeBraze() {
            try {
                braze.initialize(brazeConfig.apiKey, {
                    baseUrl: `https://${brazeConfig.endpoint}`,
                    serviceWorkerLocation: '/sw.js',
                    enableLogging: brazeConfig.enableLogging,
                    sessionTimeoutInSeconds: 30,
                    noCookies: false
                });
                
                // Subscribe to in-app messages
                braze.subscribeToInAppMessage(function(inAppMessage) {
                    showBrazeMessage(inAppMessage);
                });
                
                // Check initialization status
                const initInterval = setInterval(() => {
                    if (braze.isInitialized()) {
                        clearInterval(initInterval);
                        braze.openSession();
                        addLog('Braze SDK initialized successfully', 'success');
                    }
                }, 100);
                
                // Set timeout for initialization
                setTimeout(() => {
                    clearInterval(initInterval);
                    if (!braze.isInitialized()) {
                        addLog('Braze initialization timeout', 'error');
                    document.getElementById('registerBtn').disabled = true;
                    document.getElementById('playBtn').disabled = true;
                        document.getElementById('completeLevelBtn').disabled = true;
                        document.getElementById('makePurchaseBtn').disabled = true;
                    }
                }, 10000);
                
            } catch (error) {
                addLog('Braze initialization error: ' + error.message, 'error');
            }
        }
        
        // Register service worker for push notifications
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js', { scope: '/' })
                .then(() => addLog('Service Worker registered for push notifications', 'success'))
                .catch(err => addLog('Service Worker registration failed: ' + err.message, 'error'));
        }
        
        // Register user with Braze
        function registerUser() {
            const userId = document.getElementById('userId').value.trim();
            const userName = document.getElementById('userName').value.trim();
            const userEmail = document.getElementById('userEmail').value.trim();
            
            if (!userId || !userName || !userEmail) {
                addLog('Please fill in all user fields', 'error');
                return;
            }
            
            // Set user in Braze
            braze.changeUser(userId);
            
            // Set user attributes
            braze.getUser().setFirstName(userName);
            braze.getUser().setEmail(userEmail);
            
            // Update user state
            userState = {
                registered: true,
                id: userId,
                name: userName,
                email: userEmail
            };
            
            // Update UI
            document.getElementById('displayUserId').textContent = userId;
            document.getElementById('displayUserName').textContent = userName;
            document.getElementById('displayUserEmail').textContent = userEmail;
            document.getElementById('userInfo').style.display = 'block';
            
            // Log events
            braze.logCustomEvent('user_registered');
            addLog(`User registered: ${userName} (${userId})`, 'success');
            
            // Enable game buttons
            document.getElementById('playBtn').disabled = false;
            document.getElementById('completeLevelBtn').disabled = false;
            document.getElementById('makePurchaseBtn').disabled = false;
        }
        
        // Simulate gameplay
        function playGame() {
            if (!userState.registered) {
                addLog('Please register a user first', 'error');
                return;
            }
            
            gameState.score += Math.floor(Math.random() * 100) + 50;
            updateGameStats();
            
            braze.logCustomEvent('Charlie_Testing', { score: gameState.score });
            addLog(`Game played. Score: ${gameState.score}`, 'info');
        }
        
        // Complete a level
        function completeLevel() {
            if (!userState.registered) {
                addLog('Please register a user first', 'error');
                return;
            }
            
            gameState.level += 1;
            gameState.score += 200;
            updateGameStats();
            
            braze.logCustomEvent('level_completed', { level: gameState.level });
            addLog(`Level ${gameState.level} completed!`, 'success');
        }
        
        // Make a purchase
        function makePurchase() {
            if (!userState.registered) {
                addLog('Please register a user first', 'error');
                return;
            }
            
            const purchaseAmount = (Math.floor(Math.random() * 50) + 10).toFixed(2);
            
            braze.logPurchase('in_game_purchase', purchaseAmount, 'USD');
            addLog(`Purchase made: $${purchaseAmount}`, 'success');
        }
        
        // Update game stats UI
        function updateGameStats() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('level').textContent = gameState.level;
        }
        
        // Function to show Braze messages
        function showBrazeMessage(inAppMessage) {
            const message = inAppMessage.message || 'New message from Braze!';
            const messageType = inAppMessage.extras?.type || 'info';
            
            // Update message content
            document.getElementById('message-display-title').textContent = 
                inAppMessage.extras?.title || 'Game Notification';
            document.getElementById('message-display-content').textContent = message;
            
            // Set header color based on message type
            const header = document.getElementById('message-header');
            const colors = {
                info: '#3498db',
                success: '#27ae60',
                warning: '#f39c12',
                error: '#e74c3c'
            };
            header.style.background = colors[messageType] || colors.info;
            
            // Show message
            document.getElementById('in-app-message').classList.add('message-visible');
            
            // Log the message
            addLog(`Braze message: ${message}`, messageType);
        }
        
        // Function to add log entries
        function addLog(message, type = 'info') {
            const log = document.getElementById('messageLog');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        // Event listeners
        document.getElementById('registerBtn').addEventListener('click', registerUser);
        document.getElementById('playBtn').addEventListener('click', playGame);
        document.getElementById('completeLevelBtn').addEventListener('click', completeLevel);
        document.getElementById('makePurchaseBtn').addEventListener('click', makePurchase);
        document.getElementById('close-message').addEventListener('click', function() {
            document.getElementById('in-app-message').classList.remove('message-visible');
        });
        
        // Initialize the application
        window.addEventListener('load', function() {
            // Disable game buttons until user is registered
            document.getElementById('playBtn').disabled = true;
            document.getElementById('completeLevelBtn').disabled = true;
            document.getElementById('makePurchaseBtn').disabled = true;
            
            addLog('System ready. Please register a user to begin.', 'info');
        });
    </script>
</body>
</html>